---
// src/components/LanguageSwitcher.astro
import { languages } from '../i18n/ui'
---

<div class="flex w-full max-w-sm mx-auto align-middle justify-center">
  <select
    id="languages"
    class="text-sm rounded-lg block w-full fill-black dark:fill-black"
  >
    {Object.entries(languages).map(([code, label]) => (
      <option value={`/${code}/`}>{label}</option>
    ))}
  </select>
</div>

<script>
  const selectEl = document.querySelector<HTMLSelectElement>('#languages')
  if (!selectEl) throw new Error('LanguageSwitcher: <select> not found')

  const [, seg] = window.location.pathname.split('/')
  const prefix = seg ? `/${seg}/` : '/en/'

  selectEl.value = prefix

  const selectedOption = selectEl.querySelector(`option[value="${prefix}"]`)
  if (selectedOption) {
    selectedOption.setAttribute('hidden', '')
  }

  selectEl.addEventListener('change', (e) => {
    const target = e.target as HTMLSelectElement
    window.location.href = target.value
  })
</script>
